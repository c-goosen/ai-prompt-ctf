<div class="input-box">
    <input type="text"
           name="text_input"
           id="text_input"
           value="{{ suggestion }}">
    <input type="hidden"
           name="text_model"
           id="text_model"
           value="{{ _text_model }}">
    <input type="hidden" name="text_model" value="{{ _text_model }}">
    <i class="fa-solid fa-paper-plane"
       style="font-size:1.5rem"
       hx-post="/v1/chat/completions"
       hx-trigger="keyup[key=='Enter'] from:body, click"
       hx-include="#text_input,#text_model"
       hx-target=".chat-history"
       hx-swap="beforeend scroll:bottom"
       hx-indicator=".chat-loader"></i>
</div>

<script>
    if (!window.__chatInputResetBound) {
        window.__chatInputResetBound = true;
        document.addEventListener("htmx:afterRequest", function (event) {
            const trigger = event.detail && event.detail.elt;
            if (!trigger) {
                return;
            }
            const inputBox = trigger.closest(".input-box");
            if (!inputBox) {
                return;
            }
            const textInput = inputBox.querySelector('input[name="text_input"]');
            if (textInput) {
                textInput.value = "";
            }
        });
    }
</script>
