{% if chat_history %}
    {% for chat in chat_history %}
        {% if chat.get('metadata',{}).get('role','') in ['user'] %}
            <div class="chat chat-start">
                <div class="chat-image avatar">
                    <div class="w-10 rounded-full">
                        <i class="fa-solid fa-user" style="margin-right: 8px;"></i>
                    </div>
                </div>
                <div class="chat-bubble">
                    <md-block>{{ chat.memory | safe }}</md-block>
                </div>
            </div>
        {% endif %}
        {% if chat.get('metadata',{}).get('role','') in ['assistant'] %}
            {% if chat.memory %}
                <div class="chat chat-end">
                    <div class="chat-image avatar">
                        <div class="w-10 rounded-full">
                            <i class="fa-solid fa-robot" style="margin-right: 8px;"></i>
                        </div>
                    </div>
                    <div class="chat-bubble">
                        <md-block>{{ chat.memory | safe }}</md-block>
                    </div>
                </div>
            {% endif %}
        {% elif chat.get('metadata',{}).get('role','') in ['tool'] %}
            <div class="chat chat-end">
                <div class="chat-image avatar">
                    <div class="w-10 rounded-full">
                        <i class="fa-solid fa-wrench" style="margin-right: 8px;"></i>
                    </div>
                </div>
                <div class="chat-bubble chat-bubble-secondary">
                    <md-block>{{ chat.memory | safe }}</md-block>
                </div>
            </div>
        {% endif %}
    {% endfor %}
{% else %}
    <div class="chat chat-end">
        <div class="chat-image avatar">
            <div class="w-10 rounded-full">
                <i class="fa-solid fa-robot" style="margin-right: 8px;"></i>
            </div>
        </div>
        <div class="chat-bubble">
            Welcome to the AI agentic prompt challenge. Try different approaches, use fighting words, and see if you can convince me to share a secret.
        </div>
    </div>
    <div class="chat chat-end">
        <div class="chat-image avatar">
            <div class="w-10 rounded-full">
                <i class="fa-solid fa-robot" style="margin-right: 8px;"></i>
            </div>
        </div>
        <div class="chat-bubble">
            I remember our conversation, so experiment with multiple prompts. Helper functions like hints or submitting an answer are available when needed.
        </div>
        <div class="chat-bubble">
            I have the following tools available to you:
            - hints_func: Get hints for the current level
            - submit_answer_func: Submit your answer/flag to check if it's correct and progress to the next level
            - help_search: Search the web for help and documentation
            - get_leaderboard_stats: View leaderboard statistics
            - password_search_func: Search the database for passwords and secrets using RAG
            Some levels might have additional tools available to you, so check the level description for more information.
        </div>
    </div>
    <div class="chat chat-end">
        <div class="chat-image avatar">
            <div class="w-10 rounded-full">
                <i class="fa-solid fa-robot" style="margin-right: 8px;"></i>
            </div>
        </div>
        <div class="chat-bubble">
            Start the challenge by sending Hi. Then to move between levels, send "I want to try level X". If you get a answer, submit it to the leaderboard by sending "submit answer: Flag/Password".
        </div>
    </div>
{% endif %}
