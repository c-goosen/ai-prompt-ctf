{% set form_enabled = show_form|default(not has_session) %}
<div>
    <h3>Register User</h3>
</div>
{% if has_session %}
    <div class="faq">
        <div class="alert alert-info">
            <i class="fa-solid fa-info-circle"></i>
            <div>
                <h4>You already have a session!</h4>
                <p>User: {{ cookie_identity }}</p>
                <p>Session: {{ session_id }}</p>
            </div>
        </div>
        <div class="mt-4 flex flex-col gap-2 md:flex-row md:items-center">
            <a class="btn btn-secondary"
               href="/register?force_new=1"
               hx-get="/register?force_new=1"
               hx-target=".right-panel"
               hx-swap="innerHTML">Create a new session</a>
            <p class="text-sm opacity-80">Need a fresh conversation thread? Generate a brand new session ID.</p>
        </div>
    </div>
{% endif %}
{% if form_enabled %}
    <div class="faq">
        <div class="alert {% if has_session %}alert-info{% else %}alert-warning{% endif %}">
            <i class="fa-solid {% if has_session %}fa-repeat{% else %}fa-exclamation-triangle{% endif %}"></i>
            <div>
                {% if has_session %}
                    <h4>Create another session</h4>
                    No user session found
                    Please register first before chatting.
                    <p>Your existing cookies stay intactâ€”we'll register a fresh session below.</p>
                {% else %}
                    <h4>No session found</h4>
                    <p>Please register to create a new session.</p>
                    <p>If you are at Bsides Cape Town 2025, to qualify for the CTF, you need to register with your Quicket code.</p>
                {% endif %}
            </div>
        </div>
        <form id="register-form"
              hx-post="/register"
              hx-target=".right-panel"
              hx-swap="innerHTML"
              hx-indicator="#register-spinner">
            <div class="form-control">
                <label class="label" for="username">
                    <span class="label-text">Username *</span>
                </label>
                <input type="text"
                       name="username"
                       id="username"
                       placeholder="Enter your username"
                       value="{{ cookie_identity or '' }}"
                       class="input input-bordered"
                       required>
            </div>
            <div class="form-control">
                <label class="label" for="session_id">
                    <span class="label-text">Session ID (optional)</span>
                </label>
                <input type="text"
                       name="session_id"
                       id="session_id"
                       placeholder="Leave empty to auto-generate"
                       class="input input-bordered">
                <label class="label">
                    <span class="label-text-alt">If not provided, a unique session ID will be generated</span>
                </label>
            </div>
            <div class="form-control mt-4">
                <button type="submit" class="btn btn-primary">
                    <span id="register-spinner"
                          class="loading loading-spinner loading-sm htmx-indicator"></span>
                    Register
                </button>
            </div>
        </form>
    </div>
{% endif %}
<div class="disclaimer">
    <u> PwnGPT V1</u>. All your AGI belong to us. Christo Goosen christogoosen@gmail.com
</div>
